{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Calculadora Electrica RD - Input",
  "type": "object",
  "definitions": {
    "RoomsRequest": {
      "type": "object",
      "required": ["superficies", "consumos"],
      "properties": {
        "system": {
          "type": "object",
          "properties": {
            "voltage": {
              "type": "number",
              "default": 120,
              "description": "Tensión nominal del sistema en voltios"
            },
            "phases": {
              "type": "integer",
              "enum": [1, 3],
              "default": 1,
              "description": "Número de fases del sistema"
            },
            "frequency": {
              "type": "number",
              "default": 60,
              "description": "Frecuencia del sistema en Hz"
            }
          }
        },
        "superficies": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["nombre", "area_m2"],
            "properties": {
              "nombre": {
                "type": "string",
                "minLength": 1,
                "description": "Nombre del ambiente"
              },
              "area_m2": {
                "type": "number",
                "minimum": 0.1,
                "description": "Área del ambiente en metros cuadrados"
              }
            }
          }
        },
        "consumos": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["nombre", "ambiente", "potencia_w"],
            "properties": {
              "nombre": {
                "type": "string",
                "description": "Nombre del equipo o consumo"
              },
              "ambiente": {
                "type": "string",
                "description": "Ambiente donde se ubica el consumo"
              },
              "potencia_w": {
                "type": "number",
                "minimum": 1,
                "description": "Potencia en vatios"
              },
              "fp": {
                "type": "number",
                "minimum": 0.1,
                "maximum": 1.0,
                "description": "Factor de potencia"
              },
              "tipo": {
                "type": "string",
                "enum": [
                  "iluminacion",
                  "toma_general",
                  "electrodomestico",
                  "climatizacion",
                  "especial"
                ],
                "default": "electrodomestico",
                "description": "Tipo de consumo"
              }
            }
          }
        }
      }
    },
    "DemandRequest": {
      "type": "object",
      "required": ["cargas_por_categoria", "parametros"],
      "properties": {
        "cargas_por_categoria": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["categoria", "carga_bruta_va"],
            "properties": {
              "categoria": {
                "type": "string",
                "enum": [
                  "iluminacion_general",
                  "tomas_generales",
                  "electrodomesticos",
                  "climatizacion",
                  "especial"
                ],
                "description": "Categoría de carga"
              },
              "carga_bruta_va": {
                "type": "number",
                "minimum": 0,
                "description": "Carga bruta en voltiamperios"
              }
            }
          }
        },
        "parametros": {
          "type": "object",
          "required": ["tipo_instalacion"],
          "properties": {
            "tipo_instalacion": {
              "type": "string",
              "enum": ["residencial", "comercial", "industrial"],
              "description": "Tipo de instalación"
            }
          }
        }
      }
    },
    "CircuitsRequest": {
      "type": "object",
      "required": ["circuitos_individuales", "parametros"],
      "properties": {
        "circuitos_individuales": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["id_circuito", "nombre", "corriente_a", "carga_va", "longitud_m"],
            "properties": {
              "id_circuito": {
                "type": "string",
                "description": "Identificador único del circuito"
              },
              "nombre": {
                "type": "string",
                "description": "Nombre descriptivo del circuito"
              },
              "corriente_a": {
                "type": "number",
                "minimum": 0,
                "description": "Corriente del circuito en amperios"
              },
              "carga_va": {
                "type": "number",
                "minimum": 0,
                "description": "Carga del circuito en voltiamperios"
              },
              "longitud_m": {
                "type": "number",
                "minimum": 0,
                "description": "Longitud del circuito en metros"
              }
            }
          }
        },
        "parametros": {
          "type": "object",
          "required": ["material_conductor", "tipo_instalacion"],
          "properties": {
            "material_conductor": {
              "type": "string",
              "enum": ["Cu", "Al"],
              "description": "Material del conductor"
            },
            "tipo_instalacion": {
              "type": "string",
              "enum": ["residencial", "comercial", "industrial"],
              "description": "Tipo de instalación"
            }
          }
        }
      }
    },
    "FeederRequest": {
      "type": "object",
      "required": ["circuitos_ramales", "sistema", "parametros"],
      "properties": {
        "circuitos_ramales": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["id_circuito", "nombre", "corriente_total_a", "carga_total_va", "longitud_m"],
            "properties": {
              "id_circuito": {
                "type": "string",
                "description": "Identificador del circuito"
              },
              "nombre": {
                "type": "string",
                "description": "Nombre del circuito"
              },
              "corriente_total_a": {
                "type": "number",
                "minimum": 0,
                "description": "Corriente total del circuito"
              },
              "carga_total_va": {
                "type": "number",
                "minimum": 0,
                "description": "Carga total del circuito"
              },
              "longitud_m": {
                "type": "number",
                "minimum": 0,
                "description": "Longitud del circuito"
              }
            }
          }
        },
        "sistema": {
          "type": "object",
          "required": ["tension_v", "phases", "corriente_total_a", "carga_total_va"],
          "properties": {
            "tension_v": {
              "type": "number",
              "description": "Tensión del sistema"
            },
            "phases": {
              "type": "integer",
              "enum": [1, 3],
              "description": "Número de fases"
            },
            "corriente_total_a": {
              "type": "number",
              "minimum": 0,
              "description": "Corriente total del sistema"
            },
            "carga_total_va": {
              "type": "number",
              "minimum": 0,
              "description": "Carga total del sistema"
            }
          }
        },
        "parametros": {
          "type": "object",
          "required": ["longitud_alimentador_m", "material_conductor", "max_caida_ramal_pct", "max_caida_total_pct"],
          "properties": {
            "longitud_alimentador_m": {
              "type": "number",
              "minimum": 0,
              "description": "Longitud del alimentador"
            },
            "material_conductor": {
              "type": "string",
              "enum": ["Cu", "Al"],
              "description": "Material del conductor"
            },
            "max_caida_ramal_pct": {
              "type": "number",
              "minimum": 0,
              "maximum": 10,
              "description": "Caída máxima por ramal en porcentaje"
            },
            "max_caida_total_pct": {
              "type": "number",
              "minimum": 0,
              "maximum": 10,
              "description": "Caída máxima total en porcentaje"
            }
          }
        }
      }
    },
    "GroundingRequest": {
      "type": "object",
      "required": ["sistema", "alimentador", "parametros"],
      "properties": {
        "sistema": {
          "type": "object",
          "required": ["tension_v", "phases", "corriente_total_a", "carga_total_va"],
          "properties": {
            "tension_v": {
              "type": "number",
              "description": "Tensión del sistema"
            },
            "phases": {
              "type": "integer",
              "enum": [1, 3],
              "description": "Número de fases"
            },
            "corriente_total_a": {
              "type": "number",
              "minimum": 0,
              "description": "Corriente total del sistema"
            },
            "carga_total_va": {
              "type": "number",
              "minimum": 0,
              "description": "Carga total del sistema"
            }
          }
        },
        "alimentador": {
          "type": "object",
          "required": ["corriente_a", "seccion_mm2", "material", "longitud_m"],
          "properties": {
            "corriente_a": {
              "type": "number",
              "minimum": 0,
              "description": "Corriente del alimentador"
            },
            "seccion_mm2": {
              "type": "number",
              "minimum": 0,
              "description": "Sección del conductor en mm²"
            },
            "material": {
              "type": "string",
              "enum": ["Cu", "Al"],
              "description": "Material del conductor"
            },
            "longitud_m": {
              "type": "number",
              "minimum": 0,
              "description": "Longitud del alimentador"
            }
          }
        },
        "parametros": {
          "type": "object",
          "required": ["main_breaker_amp", "tipo_instalacion", "tipo_sistema_tierra"],
          "properties": {
            "main_breaker_amp": {
              "type": "number",
              "minimum": 0,
              "description": "Amperaje del breaker principal"
            },
            "tipo_instalacion": {
              "type": "string",
              "enum": ["residencial", "comercial", "industrial"],
              "description": "Tipo de instalación"
            },
            "tipo_sistema_tierra": {
              "type": "string",
              "enum": ["TN-S", "TN-C-S", "TT", "IT"],
              "description": "Tipo de sistema de tierra"
            },
            "resistividad_suelo_ohm_m": {
              "type": "number",
              "minimum": 0,
              "default": 100,
              "description": "Resistividad del suelo en ohm-metro"
            }
          }
        }
      }
    },
    "ReportRequest": {
      "type": "object",
      "properties": {
        "calculationId": {
          "type": "string",
          "description": "ID de cálculo existente (modo con estado)"
        },
        "roomsData": {
          "$ref": "#/definitions/RoomsResponse"
        },
        "demandData": {
          "$ref": "#/definitions/DemandResponse"
        },
        "circuitsData": {
          "$ref": "#/definitions/CircuitsResponse"
        },
        "feederData": {
          "$ref": "#/definitions/FeederResponse"
        },
        "groundingData": {
          "$ref": "#/definitions/GroundingResponse"
        },
        "installationType": {
          "type": "string",
          "enum": ["residencial", "comercial", "industrial"],
          "description": "Tipo de instalación"
        },
        "electricalSystem": {
          "type": "string",
          "description": "Descripción del sistema eléctrico"
        }
      }
    }
  },
  "allOf": [
    {
      "$ref": "#/definitions/RoomsRequest"
    }
  ]
}